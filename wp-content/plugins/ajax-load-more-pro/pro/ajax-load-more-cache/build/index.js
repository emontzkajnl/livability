(()=>{"use strict";jQuery(document).ready((function(e){const t={},a={array:window.alm_cache_array,elapsed:document.querySelector("#alm-elapsed-time"),iframe:document.querySelector(".iframe-target"),list:document.querySelector("ul.alm-generate-cache--list"),initBtn:document.querySelector("button.button-alm-generate-cache"),pauseBtn:document.querySelector(".alm-generate-cache--controls .cache-pause"),resumeBtn:document.querySelector(".alm-generate-cache--controls .cache-resume"),rebuildBtn:document.querySelector(".alm-generate-cache--controls .cache-rebuild"),txtProcessing:document.querySelector("#alm-cache-processing-txt"),txtPaused:document.querySelector("#alm-cache-paused-txt"),txtComplete:document.querySelector("#alm-cache-complete-txt"),totalEl:document.querySelector("#alm-cache-total"),totalAdminBarEl:document.querySelector("#alm-admin-bar-cache-total"),dircount:0,filecount:0,pause:!1,timer:null,elapsed_timer:null,elapsed_counter:0,current:0};let n=0,r=0,l=0;t.elapsedTime=function(){a.elapsed_timer=setInterval((function(){n++,n>=60&&(n=0,r++,r>=60&&(r=0,l++)),e("span",a.elapsed).text((l?l>9?l:"0"+l:"00")+":"+(r?r>9?r:"0"+r:"00")+":"+(n>9?n:"0"+n))}),1e3)},t.buildCache=function(){if(clearInterval(a.timer),a.current<alm_cache_array.length){const e=a.array[a.current].max?a.array[a.current].max:9999;t.setIframeSrc(a.array[a.current].url,a.array[a.current].id,e)}else t.complete()},t.setCurrent=function(){e("li",a.list).eq(a.current).addClass("current")},t.cacheItemBuilt=function(t,n){n?e("li",a.list).eq(t).removeClass("current").addClass("done"):e("li",a.list).eq(t).removeClass("current").addClass("doneError")},t.complete=function(){a.txtProcessing.style.display="none",a.txtPaused.style.display="none",a.txtComplete.style.display="block",a.pauseBtn.style.display="none",a.resumeBtn.style.display="none",a.rebuildBtn.style.display="block",a.current=0,clearInterval(a.elapsed_timer),clearInterval(a.timer)},t.pause=function(t){t.preventDefault(),a.pause=!0,a.txtProcessing.style.display="none",a.txtPaused.style.display="block",a.txtComplete.style.display="none",a.pauseBtn.style.display="none",a.resumeBtn.style.display="block",e("li",a.list).eq(a.current).removeClass("current"),clearInterval(a.elapsed_timer)},t.resume=function(n){n.preventDefault(),a.pause=!1,a.txtProcessing.style.display="block",a.txtPaused.style.display="none",a.txtComplete.style.display="none",a.pauseBtn.style.display="block",a.resumeBtn.style.display="none",e("li",a.list).eq(a.current).addClass("current"),t.elapsedTime()},t.setIframeSrc=function(n,r,l){e(a.iframe).html(""),e(a.iframe).append(e('<iframe id="myIframe" width="100%"></iframe>')),e("iframe",a.iframe).attr("src",n+"?alm_auto_cache=true"),e("iframe",a.iframe).on("load",(function(){t.setCurrent(),t.iframeLoaded(e("iframe",a.iframe).get(0),r,l)}))},t.iframeLoaded=function(e,n,r){const l=e.contentWindow.document.querySelector('.ajax-load-more-wrap[data-id="'+n+'"]');let c=0;if(l){const e=l.querySelector(".alm-load-more-btn");a.timer=setInterval((function(){a.pause||(e.classList.contains("done")||c>=r?(t.cacheItemBuilt(a.current,!0),a.current++,t.buildCache(),a.dircount++):e.classList.contains("loading")||(a.filecount++,c++,e.click(),a.totalEl&&(a.totalEl.textContent=a.filecount),a.totalAdminBarEl&&(a.totalAdminBarEl.textContent=a.filecount)))}),1500)}else t.cacheItemBuilt(a.current,!1),a.current++,t.buildCache()},a.initBtn&&a.initBtn.addEventListener("click",(function(){window.location="admin.php?page=ajax-load-more-cache&action=build"})),a.array&&a.iframe&&(t.buildCache(),t.elapsedTime(),a.txtProcessing.style.display="block"),a.pauseBtn&&(a.resumeBtn.style.display="none",a.pauseBtn.addEventListener("click",t.pause),a.resumeBtn.addEventListener("click",t.resume)),a.rebuildBtn&&a.rebuildBtn.addEventListener("click",(function(e){e.preventDefault(),window.location.reload()}))}))})();