jQuery(document).ready(function(e){"use strict";var t,a,o=houzez_vars.geo_country_limit,n=houzez_vars.geocomplete_country,s=houzez_vars.is_edit_property,c=houzez_vars.api_mapbox,r=houzez_vars.mapboxLocaleShort;if(mapboxgl&&(mapboxgl.accessToken=c,document.getElementById("geocomplete"))){var l,i,p,d;l=document.getElementById("geocomplete"),""!==(p=(i=e("#map_canvas")).data("add-lat"))&&void 0!==p||(p=25.68654),""!==(d=i.data("add-long"))&&void 0!==d||(d=-80.431345),p=parseFloat(p),d=parseFloat(d),t=new mapboxgl.Map({container:"map_canvas",style:"mapbox://styles/mapbox/streets-v11",center:[d,p],zoom:13});const g=new MapboxLanguage({defaultLanguage:r});t.addControl(g),t.addControl(new mapboxgl.NavigationControl,"top-right");var u=document.createElement("div");function m(){var s=e(l),c=s.parent(),r=e('<div class="mapbox-suggestions" style="position:absolute;z-index:1000;background:white;width:100%;border:1px solid #ccc;max-height:200px;overflow-y:auto;display:none;"></div>');c.css("position","relative"),c.append(r);var i="";0!=o&&""!=n&&("UAE"==n&&(n="AE"),i=n.toLowerCase()),s.on("input",function(){var o=e(this).val();o.length<3?r.hide():e.ajax({url:"https://api.mapbox.com/geocoding/v5/mapbox.places/"+encodeURIComponent(o)+".json",data:{access_token:mapboxgl.accessToken,autocomplete:!0,language:houzez_vars.mapboxLocale,types:"address,poi,place",country:i},success:function(o){r.empty(),o.features&&o.features.length>0?(o.features.forEach(function(o){var n=e('<div class="suggestion-item" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee;"></div>');n.text(o.place_name),n.data("feature",o),n.on("click",function(){s.val(o.place_name),e("#latitude").val(o.center[1]),e("#longitude").val(o.center[0]),a.setLngLat(o.center),o.bbox?t.fitBounds([[o.bbox[0],o.bbox[1]],[o.bbox[2],o.bbox[3]]],{padding:50}):t.flyTo({center:o.center,zoom:16}),v(o),r.hide()}),r.append(n)}),r.show()):r.hide()}})}),e(document).on("click",function(t){e(t.target).closest(".mapbox-suggestions").length||e(t.target).is(s)||r.hide()})}function v(t){if(e("#city").val(""),e("#countyState").val(""),e("#zip").val(""),e("#neighborhood").val(""),e("#country").val(""),t.context){if(t.context.forEach(function(t){var a=t.id.split(".")[0],o=t.text;"place"===a?e("#city").val(o):"region"===a?e("#countyState").val(o):"country"===a?e("#country").val(o):"postcode"===a?e("#zip").val(o):("neighborhood"===a||"district"===a&&""===e("#neighborhood").val())&&e("#neighborhood").val(o)}),""===e("#city").val()&&t.properties&&t.properties.name&&"place"===t.properties.feature_type&&e("#city").val(t.properties.name),""===e("#zip").val()&&t.properties&&t.properties.address){const a=t.properties.address.match(/\d{5}(-\d{4})?$/);a&&e("#zip").val(a[0])}""===e("#city").val()&&t.properties&&t.properties.place_name}}function b(t){e.ajax({url:"https://api.mapbox.com/geocoding/v5/mapbox.places/"+t.lng+","+t.lat+".json",data:{access_token:mapboxgl.accessToken,types:"address"},success:function(t){t.features&&t.features.length>0&&(e("#geocomplete").val(t.features[0].place_name),v(t.features[0]))}})}u.className="mapbox-marker",u.style.backgroundImage="url(https://docs.mapbox.com/mapbox-gl-js/assets/pin.svg)",u.style.width="30px",u.style.height="40px",u.style.backgroundSize="contain",u.style.backgroundRepeat="no-repeat",u.style.cursor="pointer",a=new mapboxgl.Marker({element:u,draggable:!0}).setLngLat([d,p]).addTo(t),s?t.setZoom(16):t.setZoom(13),a.on("dragend",function(){var t=a.getLngLat();e("#latitude").val(t.lat),e("#longitude").val(t.lng),b(t)}),m(),e("#find_coordinates").on("click",function(o){o.preventDefault();var n=e("#geocomplete").val(),s=e("#city").val(),c=e("#countyState").val()||"",r=e("#country").val()||"",l=n;s&&(l+=", "+s),c&&(l+=", "+c),r&&(l+=", "+r),e.ajax({url:"https://api.mapbox.com/geocoding/v5/mapbox.places/"+encodeURIComponent(l)+".json",data:{access_token:mapboxgl.accessToken,limit:1},success:function(o){if(o.features&&o.features.length>0){var n=o.features[0];e("#latitude").val(n.center[1]),e("#longitude").val(n.center[0]),a.setLngLat(n.center),t.flyTo({center:n.center,zoom:16})}}})})}});