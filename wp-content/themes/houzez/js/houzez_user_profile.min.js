jQuery(document).ready(function($){"use strict";if("undefined"!=typeof houzezUserProfile){var user_id=houzezUserProfile.user_id,ajaxURL=houzezUserProfile.ajaxURL,houzez_upload_nonce=houzezUserProfile.houzez_upload_nonce,verify_file_type=houzezUserProfile.verify_file_type,houzez_site_url=houzezUserProfile.houzez_site_url,gdpr_agree_text=houzezUserProfile.gdpr_agree_text,delete_confirmation=houzezProperty.delete_confirmation,processing_text=houzez_vars.processing_text,are_you_sure_text=houzezProperty.are_you_sure_text,delete_btn_text=houzezProperty.delete_btn_text,cancel_btn_text=houzezProperty.cancel_btn_text,confirm_btn_text=houzezProperty.confirm_btn_text,select_action=houzezProperty.select_action,no_item_selected=houzezProperty.no_item_selected,formUserID=$("#user_id").val();$("#houzez_gdpr_form").on("submit",function(e){e.preventDefault();var $this=$(this),$messages=$("#gdpr-msg"),data={action:"houzez_gdrf_data_request",gdpr_data_type:$("input[name=gdrf_data_type]:checked","#houzez_gdpr_form").val(),gdrf_data_email:$("#gdrf_data_email").val(),gdrf_data_nonce:$("#houzez_gdrf_data_nonce").val()};$.ajax({type:"POST",url:ajaxURL,data:data,beforeSend:function(){$this.find(".houzez-loader-js").addClass("loader-show")},complete:function(){$this.find(".houzez-loader-js").removeClass("loader-show")},success:function(e){e.success?$messages.empty().append('<div class="alert alert-success" role="alert">'+e.data+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'):$messages.empty().append('<div class="alert alert-danger" role="alert">'+e.data+'<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>')},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}})}),$("#houzez_stripe_cancel").click(function(){var e;$(this).attr("data-stripeid"),e=$(this).attr("data-message"),$("#stripe_cancel_success").text(processing_text),$.ajax({type:"POST",url:ajaxURL,data:{action:"houzez_cancel_stripe"},success:function(a){$("#stripe_cancel_success").text(e)},error:function(e){}})}),$("#houzez_paypal_cancel").click(function(){var e;e=$(this).attr("data-message"),$("#paypal_cancel_success").text(processing_text),$.ajax({type:"POST",url:ajaxURL,data:{action:"houzez_cancel_paypal"},success:function(a){$("#paypal_cancel_success").text(e)},error:function(e){}})}),$("#houzez_agency_agent_register").on("click",function(e){e.preventDefault();var currnt=$(this),$form=$(this).parents("form"),$messages=$("#aa_register_message");$messages.empty(),$.ajax({type:"post",url:ajaxURL,dataType:"json",data:$form.serialize(),beforeSend:function(){currnt.find(".houzez-loader-js").addClass("loader-show")},complete:function(){currnt.find(".houzez-loader-js").removeClass("loader-show")},success:function(e){e.success?($("#aa_username, #aa_email, #aa_firstname, #aa_lastname, #aa_password").val(""),$messages.empty().append('<div class="alert alert-success alert-dismissible fade show mt-3" role="alert">'+e.msg+"</div>")):$messages.empty().append('<div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">'+e.msg+"</div>")},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}})}),$("#houzez_agency_agent_update").on("click",function(e){e.preventDefault();var currnt=$(this),$form=$(this).parents("form"),$messages=$("#aa_register_message");$.ajax({type:"post",url:ajaxURL,dataType:"json",data:$form.serialize(),beforeSend:function(){currnt.find(".houzez-loader-js").addClass("loader-show")},complete:function(){currnt.find(".houzez-loader-js").removeClass("loader-show")},success:function(e){e.success?$messages.empty().append('<div class="alert alert-success" role="alert"><i class="houzez-icon icon-check-circle-1 me-1"></i>'+e.msg+"</div>"):$messages.empty().append('<div class="alert alert-danger" role="alert"><i class="houzez-icon icon-check-circle-1 me-1"></i>'+e.msg+"</div>")},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}})}),$(".houzez_update_profile").click(function(e){e.preventDefault();var a=$(this),t=a.parents("form"),s=a.parents(".block-wrap").find(".notify"),r="";if(r="undefined"!=typeof tinyMCE&&null!==tinyMCE.get("about")?tinyMCE.get("about").getContent():$("#about").val()||"",$("#gdpr_agreement").length>0){if(!$("#gdpr_agreement").is(":checked"))return jQuery("#profile_message").empty().append('<div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-hide="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+gdpr_agree_text+"</div>"),$(".dashboard-content-area").animate({scrollTop:0},"slow"),!1;0}$.ajax({url:ajaxURL,data:t.serialize()+"&bio="+encodeURIComponent(r),method:t.attr("method"),dataType:"JSON",beforeSend:function(){a.find(".houzez-loader-js").addClass("loader-show")},success:function(e){e.success?houzez.Core.util.showSuccess(s,e.data.message):houzez.Core.util.showError(s,e.data.message)},error:function(e){},complete:function(){a.find(".houzez-loader-js").removeClass("loader-show")}})}),$("#houzez_change_pass").click(function(e){var a,t,s;e.preventDefault();var r=$(this);t=$("#newpass").val(),s=$("#confirmpass").val(),a=$("#houzez-security-pass").val(),$.ajax({type:"POST",dataType:"json",url:ajaxURL,data:{action:"houzez_ajax_password_reset",newpass:t,confirmpass:s,user_id:formUserID,"houzez-security-pass":a},beforeSend:function(){r.find(".houzez-loader-js").addClass("loader-show")},success:function(e){e.success?(jQuery("#password_reset_msgs").empty().append('<p class="success text-success"><i class="fa fa-check"></i> '+e.msg+"</p>"),jQuery("#newpass, #confirmpass").val("")):jQuery("#password_reset_msgs").empty().append('<p class="error text-danger"><i class="fas fa-times"></i> '+e.msg+"</p>")},error:function(e){},complete:function(){r.find(".houzez-loader-js").removeClass("loader-show")}})}),$("#houzez_delete_account").on("click",function(e){e.preventDefault();var $this=$(this),propID=$this.data("id"),propNonce=$this.data("nonce");return bootbox.confirm({message:"<strong>"+delete_confirmation+"</strong>",closeButton:!1,buttons:{confirm:{label:delete_btn_text,className:"btn btn-primary"},cancel:{label:cancel_btn_text,className:"btn btn-grey-outlined"}},callback:function(result){1==result&&(profile_processing_modal(processing_text),$.ajax({type:"post",url:ajaxURL,dataType:"json",data:{action:"houzez_delete_account",user_id:formUserID},success:function(e){e.success&&(window.location.href=houzez_site_url)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}}))}}),!1});var delete_profile_pic=function(){$(".delete-profile-pic").on("click",function(e){e.preventDefault();var $this=$(this),picID=$("#profile-pic-id").val();return bootbox.confirm({message:"<strong>"+delete_confirmation+"</strong>",closeButton:!1,buttons:{confirm:{label:delete_btn_text,className:"btn btn-primary"},cancel:{label:cancel_btn_text,className:"btn btn-grey-outlined"}},callback:function(result){1==result&&(profile_processing_modal(processing_text),$.ajax({type:"post",url:ajaxURL,dataType:"json",data:{action:"houzez_delete_profile_pic",picture_id:picID,user_id:formUserID},success:function(e){e.success&&window.location.reload()},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}}))}}),!1})};function houzezDeleteAgents(e,a){Array.isArray(e)||(e=[e]),$.ajax({url:ajaxURL,type:"POST",dataType:"json",data:{action:"houzez_delete_agents",agent_ids:e,security:a},beforeSend:function(){profile_processing_modal(processing_text)},success:function(a){profile_processing_modal_close(),a.success?($("#houzez_messages").append('<div class="alert alert-success alert-dismissible fade show mt-3">'+(a.data&&a.data.message?a.data.message:"Properties successfully deleted")+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>'),e.length>1&&(e.forEach(function(e){$('input.agent-bulk-delete[value="'+e+'"]').closest("tr").remove()}),$("#agent_select_all").prop("checked",!1)),setTimeout(function(){location.reload()},800)):$("#houzez_messages").append('<div class="alert alert-danger alert-dismissible fade show mt-3">'+(a.data&&a.data.message?a.data.message:"Error deleting properties")+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>')},error:function(e,a,t){profile_processing_modal_close(),$("#houzez_messages").append('<div class="alert alert-danger alert-dismissible fade show mt-3">'+(t||"An error occurred while deleting properties")+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>')}})}delete_profile_pic(),$(document).on("click",".houzez_delete_agency_agent",function(e){e.preventDefault();var a=$(this),t=a.data("id"),s=a.data("nonce");bootbox.confirm({message:"<strong>"+delete_confirmation+"</strong>",closeButton:!1,buttons:{confirm:{label:delete_btn_text,className:"btn btn-primary"},cancel:{label:cancel_btn_text,className:"btn btn-grey-outlined"}},callback:function(e){e&&houzezDeleteAgents(t,s)}})}),$("#agent-bulk-action-apply").on("click",function(e){if(e.preventDefault(),"Delete"===$("#agent-bulk-action-select").val()){var a=$(".agent-bulk-delete:checked").map(function(){return $(this).val()}).get();if(a.length){var t=$("#bulk-action-nonce").val();bootbox.confirm({message:"<strong>"+delete_confirmation+"</strong>",closeButton:!1,buttons:{confirm:{label:delete_btn_text,className:"btn btn-primary"},cancel:{label:cancel_btn_text,className:"btn btn-grey-outlined"}},callback:function(e){e&&houzezDeleteAgents(a,t)}})}else alert(no_item_selected)}else alert(select_action)}),$("#houzez_user_role").on("change",function(e){e.preventDefault();var user_role=$(this).val(),nonce=$("#houzez-role-security-pass").val(),_wp_http_referer=$('input[name="_wp_http_referer"]').val();$.ajax({type:"post",url:ajaxURL,dataType:"json",data:{action:"houzez_change_user_role",role:user_role,"houzez-role-security-pass":nonce,_wp_http_referer:_wp_http_referer},beforeSend:function(){profile_processing_modal(processing_text)},success:function(e){e.success&&window.location.reload(!0)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}})}),$("#houzez_user_package").on("change",function(e){e.preventDefault();var permission_val=$(this).val(),nonce=$("#houzez-agency-package-security").val(),_wp_http_referer=$('input[name="_wp_http_referer"]').val();$.ajax({type:"post",url:ajaxURL,dataType:"json",data:{action:"houzez_user_package_permission",agency_allow_package:permission_val,"houzez-role-security-pass":nonce,_wp_http_referer:_wp_http_referer},beforeSend:function(){profile_processing_modal(processing_text)},success:function(e){e.success||(profile_processing_modal_close(),alert(e.reason)),window.location.reload(!0)},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}})}),$("#houzez_user_currency").on("change",function(e){e.preventDefault();var user_currency=$(this).val(),nonce=$("#houzez-user-currency-security-pass").val();$.ajax({type:"post",url:ajaxURL,dataType:"json",data:{action:"houzez_change_user_currency",currency:user_currency,"houzez-user-currency-security-pass":nonce},beforeSend:function(){profile_processing_modal(processing_text)},success:function(e){e.success&&window.location.reload()},error:function(xhr,status,error){var err=eval("("+xhr.responseText+")")}})});var profile_processing_modal=function(e){var a='<div class="modal fade" id="fave_modal" tabindex="-1" role="dialog" aria-labelledby="faveModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-body houzez_messages_modal">'+e+"</div></div></div></div></div>";jQuery("body").append(a),jQuery("#fave_modal").modal("show")},profile_processing_modal_close=function(){jQuery("#fave_modal").modal("hide")},houzez_plupload=new plupload.Uploader({browse_button:"select_user_profile_photo",file_data_name:"houzez_file_data_name",multi_selection:!1,url:ajaxURL+"?action=houzez_user_picture_upload&verify_nonce="+houzez_upload_nonce+"&user_id="+formUserID,filters:{mime_types:[{title:verify_file_type,extensions:"jpg,jpeg,gif,png,webp"}],max_file_size:"12000kb",prevent_duplicates:!0}});houzez_plupload.init(),houzez_plupload.bind("FilesAdded",function(e,a){var t="";plupload.each(a,function(e){t+='<div id="imageholder-'+e.id+'" class="houzez-thumb"></div>'}),document.getElementById("houzez_profile_photo").innerHTML=t,e.refresh(),houzez_plupload.start()}),houzez_plupload.bind("UploadProgress",function(e,a){document.getElementById("imageholder-"+a.id).innerHTML="<span>"+a.percent+"%</span>"}),houzez_plupload.bind("Error",function(e,a){document.getElementById("houzez_upload_errors").innerHTML+="<br/>Error #"+a.code+": "+a.message}),houzez_plupload.bind("FileUploaded",function(e,a,t){var s=$.parseJSON(t.response);if(s.success){var r='<a href="#" class="delete-profile-pic"><i class="houzez-icon icon-close"></i></a><img class="img-fluid" src="'+s.url+'" alt="" /><input type="hidden" class="profile-pic-id" id="profile-pic-id" name="profile-pic-id" value="'+s.attachment_id+'"/>';document.getElementById("imageholder-"+a.id).innerHTML=r,delete_profile_pic()}});var HouzezCheckboxManager=function(){function e(e,a,t){var s=e.find(t).length,r=e.find(t+":checked").length;e.find(a).prop("checked",s>0&&s===r)}return{init:function(a,t,s){var r=$(a);r.length&&(r.on("change",t,function(){var e=$(this).prop("checked");r.find(s).prop("checked",e)}),r.on("change",s,function(){e(r,t,s)}),e(r,t,s))}}}();$(document).ready(function(){HouzezCheckboxManager.init(".houzez-data-table","#agent_select_all",".agent-bulk-delete")})}});